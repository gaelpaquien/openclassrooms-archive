let trProducts, tdName, tdLenses, tdPrice, btnClear = document.getElementById("clear-order_summary"), form = document.querySelector("form"), productSelect = JSON.parse(sessionStorage.getItem("product")), tBody = document.querySelector("tbody"); function confirmOrder() { if (null == productSelect) btnClear.addEventListener("click", function (e) { alert("Vous n'avez aucun produit."), window.open("index.html", "_parent") }), form.addEventListener("submit", function (e) { event.preventDefault(), alert("Vous ne pouvez pas confirmer votre commande avec un panier vide."), window.open("index.html", "_parent") }); else if (0 != productSelect.length) { for (let e = 0; e < productSelect.length; e++)createTable(), tdName.innerHTML = productSelect[e].name, tdLenses.innerHTML = productSelect[e].lenses, tdPrice.innerHTML = productSelect[e].price + " €"; total(), btnClear.addEventListener("click", function (e) { sessionStorage.clear(), history.go(0) }), form.addEventListener("submit", function (e) { event.preventDefault(), postRequest() }) } } function createTable() { trProducts = document.createElement("tr"), tBody.appendChild(trProducts), tdName = document.createElement("td"), trProducts.appendChild(tdName), tdLenses = document.createElement("td"), trProducts.appendChild(tdLenses), tdPrice = document.createElement("td"), trProducts.appendChild(tdPrice) } function total() { let e = document.querySelector("tfoot"), t = document.createElement("tr"); e.appendChild(t); let r = document.createElement("td"); t.appendChild(r), r.setAttribute("colspan", "3"), r.setAttribute("class", "total"); let o = 0; for (let e = 0; e < productSelect.length; e++)o += productSelect[e].price; totalPrice = o, r.innerHTML = "Prix total : " + totalPrice + " €"; let n = { totalPrice: totalPrice }; sessionStorage.setItem("orderInfo", JSON.stringify(n)) } function postRequest() { let e = [], t = { lastName: form.name.value, firstName: form.firstName.value, email: form.mail.value, address: form.adress.value, city: form.city.value }; for (let t = 0; t < productSelect.length; t++) { let r = productSelect[t].id; e.push(r) } !async function (e) { let t = await fetch("http://localhost:3000/api/cameras/order", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(e) }); t.ok ? (await t.json(), window.open("confirmation.html", "_parent"), sessionStorage.removeItem("product")) : console.error("Retour du serveur : " + t.status) }({ contact: t, products: e }) } confirmOrder();